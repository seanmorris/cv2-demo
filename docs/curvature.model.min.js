"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.ButtonField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var ButtonField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f),g.args.title=g.args.title||g.args.value,g._onClick=[];var h=g.args.attrs||{};return h.type=h.type||g.args.type,g.args.name=h.name=g.args.name||f,g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<input\n\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\ttype      = \"").concat(h.type,"\"\n\t\t\t\t\tvalue     = \"[[value]]\"\n\t\t\t\t\tcv-on     = \"click:clicked(event)\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"clicked",value:function clicked(a){var b=this._onClick.map(function(b){return!1===b(a)}).filter(function(a){return a});return b.length?void("submit"==this.args.attrs.type&&(a.preventDefault(),a.stopPropagation())):void("submit"==this.args.attrs.type&&(a.preventDefault(),a.stopPropagation(),this.form.tags.formTag.element.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))))}},{key:"onClick",value:function onClick(a){this._onClick.push(a)}}]),b}(_Field2.Field);exports.ButtonField=ButtonField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Field=void 0;var _View2=require("../base/View"),_Bindable=require("../base/Bindable");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Field=function(a){function b(a,d,e,f){var g,h,i,j;_classCallCheck(this,b);var k=Object.assign({},a);j=c.call(this,k),j.args.title=null!==(g=j.args.title)&&void 0!==g?g:f,j.args.value=null!==(h=j.args.value)&&void 0!==h?h:"",j.value=null!==(i=j.args.value)&&void 0!==i?i:"",j.skeleton=k,j.disabled=null,j.args.valueString="",j.form=d,j.parent=e,j.key=f,j.ignore=!!j.args.attrs&&(j.args.attrs["data-cv-ignore"]||!1);var l="",m=j.args.attrs||{};m.type=m.type||k.type||null,j.args.name=m.name=m.name||j.args.name||f,"checkbox"==m.type&&(l="value = \"1\""),j.template="\n\t\t\t<label\n\t\t\t\tfor           = \"".concat(j.getName(),"\"\n\t\t\t\tdata-type     = \"").concat(m.type||"text","\"\n\t\t\t\tcv-ref        = \"label:curvature/base/Tag\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<input\n\t\t\t\t\tname      = \"").concat(j.getName(),"\"\n\t\t\t\t\ttype      = \"").concat(m.type||"text","\"\n\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t\t").concat(l,"\n\t\t\t\t/>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t");var n=null;return j.args.bindTo("value",function(a,b){if(!isNaN(a)&&a.length&&a==+a&&a.length===(+a+"").length&&(a=+a),j.value=a,n!=b){if(n=f,j.args.valueString=JSON.stringify(a||"",null,4),j.valueString=j.args.valueString,!("file"==m.type&&j.tags.input&&j.tags.input.element.files&&j.tags.input.element.length))j.parent.args.value||(j.parent.args.value={}),j.parent.args.value[f]=a;else if(!m.multiple)j.parent.args.value[f]=j.tags.input.element.files[0];else{var c=Array.from(j.tags.input.element.files);if(!j.parent.args.value[b]||!c.length)j.parent.args.value[f]=c;else{for(var d in c)c[d]!==j.parent.args.value[f][d]&&(j.parent.args.value[f]=c);j.parent.args.value.splice(c.length)}}j.args.errors=[],n=null}}),j.parent.args.value[j.key]=j.args.value,j.parent.args.value.bindTo(f,function(a,b){if(n!=b){if(n=b,"file"!=m.type)j.args.value=a;else if(!(j.tags.input&&j.tags.input.element.files&&j.tags.input.element.files.length))j.args.value=a;else if(!m.multiple)j.parent.args.value[f]=j.tags.input.element.files[0];else{var c=Array.from(j.tags.input.element.files);if(!j.parent.args.value[f]||!c.length)j.parent.args.value[f]=c;else{for(var d in c)c[d]!==j.parent.args.value[f][d]&&(j.parent.args.value[f]=c);j.parent.args.value[f].splice(c.length)}}n=null}}),j}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"disable",value:function disable(){this.hasChildren(),this.disabled="disabled"}},{key:"enable",value:function enable(){this.hasChildren(),this.disabled=!1}},{key:"hasChildren",value:function hasChildren(){return!1}},{key:"getName",value:function getName(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];if(this.tags.input)return this.tags.input.element.getAttribute("name");var b=this.key;if(a){for(var c=this.parent,d=[b];c&&c.array&&"undefined"!=typeof c.key;)d.unshift(c.key),c=c.parent;b=d.shift(),d.length&&(b+="[".concat(d.join("]["),"]"))}return b}}]),b}(_View2.View);exports.Field=Field;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FieldSet=void 0;var _Field2=require("./Field"),_Form=require("./Form");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FieldSet=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||"fieldset",g.array=!1,(a.array||h["data-array"]||h["data-multi"])&&(g.array=h["data-array"]=!0),g.args.value={},g.args.fields=_Form.Form.renderFields(a.children,_assertThisInitialized(g)),g.fields=g.args.fields,g.template="\n\t\t\t<label\n\t\t\t\tfor        = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type  = \"").concat(h.type,"\"\n\t\t\t\tdata-multi = \"").concat(h["data-multi"]?"true":"false","\"\n\t\t\t\tcv-ref     = \"label:curvature/base/Tag\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<fieldset\n\t\t\t\t\tname   = \"").concat(g.getName(),"\"\n\t\t\t\t\tcv-ref = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand=\"attrs\"\n\t\t\t\t\tcv-each = \"fields:field\"\n\t\t\t\t>\n\t\t\t\t\t[[field]]\n\t\t\t\t</fieldset>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"hasChildren",value:function hasChildren(){return!!Object.keys(this.args.fields).length}},{key:"wrapSubfield",value:function wrapSubfield(a){return a}}]),b}(_Field2.Field);exports.FieldSet=FieldSet;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.FileField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FileField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||g.args.type||"file",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t>\n\t\t\t\t<input\n\t\t\t\t\tname    = \"").concat(g.getName(),"\"\n\t\t\t\t\ttype    = \"").concat(h.type,"\"\n\t\t\t\t\tcv-bind = \"value\"\n\t\t\t\t\tcv-ref  = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t<span style = \"display:none\" cv-if = \"value\">[[[value]]]</span>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.FileField=FileField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Form=void 0;var _View2=require("../base/View"),_Field=require("./Field"),_FieldSet=require("./FieldSet"),_SelectField=require("./SelectField"),_RadioField=require("./RadioField"),_HtmlField=require("./HtmlField"),_HiddenField=require("./HiddenField"),_ButtonField=require("./ButtonField"),_TextareaField=require("./TextareaField"),_View3=require("./multiField/View"),_Bindable=require("../base/Bindable");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Form=function(a){function b(a){var d,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,b),d=c.call(this,{}),d.args.flatValue=d.args.flatValue||{},d.args.value=d.args.value||{},d.args.method=a._method||"GET",d.args.classes=d.args.classes||[],d.skeleton=a,d.args.bindTo("classes",function(a){d.args._classes=a.join(" ")}),d._onSubmit=[],d._onRender=[],d.action="",d.template="\n\t\t\t<form\n\t\t\t\tclass     = \"[[_classes]]\"\n\t\t\t\tmethod    = \"[[method]]\"\n\t\t\t\tenctype   = \"multipart/form-data\"\n\t\t\t\tcv-on     = \"submit:submit(event)\"\n\t\t\t\tcv-ref    = \"formTag:curvature/base/Tag\"\n\t\t\t\tcv-each   = \"fields:field\"\n\t\t\t\tcv-expand = \"attrs\"\n\t\t\t>\n\t\t\t\t[[field]]\n\t\t\t</form>\n\t\t",d.args.fields=b.renderFields(a,_assertThisInitialized(d),e),d.fields=d.args.fields;var f=_Bindable.Bindable.makeBindable(_assertThisInitialized(d));return d.args.bindTo("value",function(a){f.value=a}),d.args.bindTo("valueString",function(a){f.json=a}),_possibleConstructorReturn(d,f)}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"submitHandler",value:function submitHandler(a){a.preventDefault(),a.stopPropagation()}},{key:"submit",value:function submit(a){for(var b in this.args.valueString=JSON.stringify(this.args.value,null,4),this._onSubmit)this._onSubmit[b](this,a)}},{key:"buttonClick",value:function buttonClick(){}},{key:"onSubmit",value:function onSubmit(a){this._onSubmit.push(a)}},{key:"onRender",value:function onRender(a){return this.nodes?void a(this):void this._onRender.push(a)}},{key:"formData",value:function formData(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];a||(a=new FormData),b||(b=this);for(var g in b.args.fields)if(!(b.args.fields[g]&&b.args.fields[g].disabled)){var d=c.slice(0);if(d.push(g),b.args.fields[g]&&b.args.fields[g].hasChildren())this.formData(a,b.args.fields[g],d);else if(b.args.fields[g]){var h=b.args.fields[g].getName();if(!("file"==b.args.fields[g].args.type&&b.args.fields[g].tags.input.element.files&&b.args.fields[g].tags.input.element.files.length))("file"!==b.args.fields[g].args.type||b.args.fields[g].args.value)&&a.append(h,void 0===b.args.fields[g].args.value?"":b.args.fields[g].args.value);else if(b.args.fields[g].args.attrs.multiple)for(var e=b.args.fields[g].tags.input.element.files,f=0;f<e.length;f++)e[f]&&a.append(h+"[]",e[f]);else b.args.fields[g].tags.input.element.files[0]&&a.append(h,b.args.fields[g].tags.input.element.files[0])}}return a}},{key:"queryString",value:function queryString(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=[];for(var c in this.args.flatValue)a[c]=a[c]||this.args.flatValue[c];for(var d in a)b.push(d+"="+encodeURIComponent(a[d]));return b.join("&")}},{key:"populate",value:function populate(a){for(var b in a)this.args.value[b]=a[b]}},{key:"hasChildren",value:function hasChildren(){return!!Object.keys(this.args.fields).length}},{key:"postRender",value:function postRender(){for(var a in this._onRender)this._onRender[a](this)}}],[{key:"renderFields",value:function renderFields(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e={},f=function(f){if(e[f])return"continue";if("_"==f.substr(0,1))return"continue";var g=null,h=null;if(c&&(c instanceof b?h=c:h=c.form),d&&a[f].name in d)g=new d[a[f].name](a[f],h,c,f);else switch(a[f].type){case"fieldset":g=a[f].attrs&&a[f].attrs["data-multi"]?new _View3.View(a[f],h,c,f):new _FieldSet.FieldSet(a[f],h,c,f);break;case"select":g=new _SelectField.SelectField(a[f],h,c,f);break;case"radios":g=new _RadioField.RadioField(a[f],h,c,f);break;case"html":g=new _HtmlField.HtmlField(a[f],h,c,f);break;case"submit":case"button":g=new _ButtonField.ButtonField(a[f],h,c,f);break;case"hidden":g=new _HiddenField.HiddenField(a[f],h,c,f);break;case"textarea":g=new _TextareaField.TextareaField(a[f],h,c,f);break;default:g=new _Field.Field(a[f],h,c,f);}e[f]=g;var i=g.key;g.args.bindTo("value",function(a,b,d){if(!isNaN(a)&&a.length&&a==+a&&a.length===(+a+"").length&&(a=+a),("html"!=d.type||d.contentEditable)&&"fieldset"!=d.type){if(d.disabled)return void delete h.args.flatValue[i];d.attrs=d.attrs||{};var e=d.attrs.multiple,f=Array.isArray(a),g=c.args.value[i],j=d.attrs.multiple&&f&&Array.isArray(g);if(j)for(var k in a)a[k]!==c.args.value[i][k]&&(c.args.value[i][k]=a[k]),c.args.value[i].splice(a.length);else c.args.value[i]=a;h.args.flatValue[i]=a,h.args.valueString=JSON.stringify(h.args.value,null,4),console.log()}})};for(var h in a){var g=f(h)}return e}},{key:"_updateFields",value:function _updateFields(a,b){for(var c in a.args.fields){var d=a.args.fields[c];b[c]&&(b[c].value&&(d.args.value=b[c].value),b[c].errors&&(d.args.errors=b[c].errors),b[c].title&&(d.args.title=b[c].title),b[c].options&&(d.args.options=b[c].options),b[c].attrs&&(d.args.attrs=b[c].attrs),d.children&&b[c].children&&this._updateFields(d,b[c].children))}}}]),b}(_View2.View);exports.Form=Form;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.HiddenField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var HiddenField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),a.type="hidden",g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.args.type=h.type=h.type||g.args.type||"hidden",g.args.name=h.name=h.name||g.args.name||f,g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tstyle     = \"display:none\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<input\n\t\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\t\ttype      = \"hidden\"\n\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t<span cv-if = \"value\">[[[value]]]</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.HiddenField=HiddenField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.HtmlField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var HtmlField=function(a){function b(a,d,e,f){var g;return _classCallCheck(this,b),g=c.call(this,a,d,e,f),g.key=f,g.args.tagName=g.args.tagName||"div",g.args.displayValue=g.args.value,g.args.attrs=g.args.attrs||{},g.ignore=g.args.attrs["data-cv-ignore"]||!1,g.args.contentEditable=g.args.attrs.contenteditable||!1,g.args.bindTo("value",function(a){g.tags.input&&g.tags.input.element!==document.activeElement&&(g.args.displayValue=a)}),g.template="<".concat(g.args.tagName,"\n\t\t\tname            = \"").concat(g.getName(),"\"\n\t\t\tcv-ref          = \"input:curvature/base/Tag\"\n\t\t\tcontenteditable = \"[[contentEditable]]\"\n\t\t\tcv-expand       = \"attrs\"\n\t\t\tcv-bind         = \"$displayValue\"\n\t\t\tcv-on           = \"input:inputProvided(event);\"\n\t\t></").concat(g.args.tagName,">"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"inputProvided",value:function inputProvided(a){this.args.value=a.target.innerHTML}},{key:"hasChildren",value:function hasChildren(){return!1}},{key:"getName",value:function getName(){return this.key}}]),b}(_Field2.Field);exports.HtmlField=HtmlField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.RadioField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var RadioField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.args.name=h.name=h.name||g.args.name||f,g.args.value=g.args.value||"",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<span cv-each  = \"options:option:optionText\"/>\n\t\t\t\t\t<label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tname      = \"").concat(g.args.name,"\"\n\t\t\t\t\t\t\ttype      = \"radio\"\n\t\t\t\t\t\t\tvalue     = \"[[option]]\"\n\t\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t\t\t\tcv-on     = \"change:changed(event)\"\n\t\t\t\t\t/>\n\t\t\t\t\t\t[[optionText]]\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"getLabel",value:function getLabel(){for(var a in this.args.options)if(this.args.options[a]==this.args.value)return a}},{key:"changed",value:function changed(a){this.args.value=a.target.value}}]),b}(_Field2.Field);exports.RadioField=RadioField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.SelectField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var SelectField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type||"select","\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<select\n\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\tcv-each   = \"options:option:optionText\"\n\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t/>\n\t\t\t\t\t<option value = \"[[option]]\">[[optionText]]</option>\n\t\t\t\t</select>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"postRender",value:function postRender(){var a=this;this.args.bindTo("value",function(b){return a.selectOptionByValue(b)}),this.args.options.bindTo(function(){return a.selectOptionByValue(a.args.value)},{frame:1})}},{key:"selectOptionByValue",value:function selectOptionByValue(a){var b,c=this.tags.input.element,d=_createForOfIteratorHelper(c.options);try{for(d.s();!(b=d.n()).done;){var e=b.value;e.value==a&&(c.selectedIndex=e.index)}}catch(a){d.e(a)}finally{d.f()}}},{key:"getLabel",value:function getLabel(){for(var a in this.args.options)if(this.args.options[a]==this.args.value)return a}}]),b}(_Field2.Field);exports.SelectField=SelectField;
"use strict";var _Field2=require("./Field");Object.defineProperty(exports,"__esModule",{value:!0}),exports.TextareaField=void 0;function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var TextareaField=function(a){function b(a,d,e,f){var g;_classCallCheck(this,b),g=c.call(this,a,d,e,f);var h=g.args.attrs||{};return h.type=h.type||"textarea",g.template="\n\t\t\t<label\n\t\t\t\tfor       = \"".concat(g.getName(),"\"\n\t\t\t\tdata-type = \"").concat(h.type,"\"\n\t\t\t\tcv-ref    = \"label:curvature/base/Tag\">\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\t\t\t\t<textarea\n\t\t\t\t\t\tname      = \"").concat(g.getName(),"\"\n\t\t\t\t\t\tcv-bind   = \"value\"\n\t\t\t\t\t\tcv-ref    = \"input:curvature/base/Tag\"\n\t\t\t\t\t\tcv-expand = \"attrs\"\n\t\t\t\t></textarea>\n\t\t\t\t<cv-template cv-if = \"attrs.data-caption\">\n\t\t\t\t\t<p>[[attrs.data-caption]]</p>\n\t\t\t\t</cv-template>\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return b}(_Field2.Field);exports.TextareaField=TextareaField;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreateForm=void 0;var _FormWrapper2=require("./FormWrapper"),_HiddenField=require("../../form/HiddenField");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var CreateForm=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a,d,"POST",g||{}),e.creating=!!a.publicId,e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"onLoad",value:function onLoad(a){for(var d in a.args.fields)if(a.args.fields[d].tags.input&&"hidden"!=a.args.fields[d].args.attrs.type){var c=a.args.fields[d].tags.input.element;c.focus();break}_get(_getPrototypeOf(b.prototype),"onLoad",this).call(this,a)}},{key:"onRequest",value:function onRequest(){return this.args.view.args.loading=!0,this.args.view.args.classes+=" loading",_get(_getPrototypeOf(b.prototype),"onRequest",this).call(this)}},{key:"onResponse",value:function onResponse(a){return this.args.view.args.loading=!1,this.args.view.args.classes="",a.body?void(this.args.wrapper?this.args.wrapper.refresh(a.body):this.args.view.addRecord(a.body),this.args.view.args.creating="",_get(_getPrototypeOf(b.prototype),"onResponse",this).call(this,a)):void _get(_getPrototypeOf(b.prototype),"onResponse",this).call(this,a)}}]),b}(_FormWrapper2.FormWrapper);exports.CreateForm=CreateForm;
"use strict";
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FormWrapper=void 0;var _Repository=require("../../base/Repository"),_Form=require("../../form/Form"),_Toast=require("../../toast/Toast"),_ToastAlert=require("../../toast/ToastAlert"),_View2=require("../../base/View"),_Router=require("../../base/Router");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _createForOfIteratorHelper(a,b){var c;if("undefined"==typeof Symbol||null==a[Symbol.iterator]){if(Array.isArray(a)||(c=_unsupportedIterableToArray(a))||b&&a&&"number"==typeof a.length){c&&(a=c);var d=0,e=function(){};return{s:e,n:function n(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function e(a){throw a},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function s(){c=a[Symbol.iterator]()},n:function n(){var a=c.next();return g=a.done,a},e:function e(a){h=!0,f=a},f:function f(){try{g||null==c["return"]||c["return"]()}finally{if(h)throw f}}}}function _unsupportedIterableToArray(a,b){if(a){if("string"==typeof a)return _arrayLikeToArray(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(a,b):void 0}}function _arrayLikeToArray(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var FormWrapper=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a),e.path=d,e.args.method=f,e.args.action=e.args.action||null,e.args.form=null,e.args.title=null,e.args["class"]="",e.template="\n\t\t\t<div class = \"form constrict [[class]]\">\n\t\t\t\t<div cv-if = \"title\"><label>[[title]]</label></div>\n\t\t\t\t[[form]]\n\t\t\t</div>\n\t\t",e._onLoad=[],e._onSubmit=[],e._onRender=[],e._onRequest=[],e._onError=[],e._onResponse=[],d instanceof _Form.Form?e.loadForm(form,g):_Repository.Repository.request(d).then(function(a){return a&&a.meta&&a.meta.form&&a.meta.form instanceof Object?void(e.loadForm(new _Form.Form(a.meta.form,g)),e.onLoad(e.args.form,a.body)):void console.log("Cannot render form with ",a)}),e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"loadForm",value:function loadForm(a){var b=this;this.args.form=a,this.args.form.onSubmit(function(a,c){if(!1!==b.onSubmit(a,c)){c&&(c.preventDefault(),c.stopPropagation());var d=a.tags.formTag.element,e=d.getAttribute("action")||b.args.action||b.path,f=d.getAttribute("method")||b.args.method,g=a.args.flatValue;if(f=f.toUpperCase(),"GET"==f){var l={};for(var m in b.args.content&&b.args.content.args&&(b.args.content.args.page=0),l.page=0,g)"api"!=m&&(l[m]=g[m]);var i=b.onRequest(l);i.then(function(){b.onResponse({}),_Router.Router.go(e+"?"+_Router.Router.queryToString(l)),b.update(l)})["catch"](function(a){b.onRequestError(a)})}else if("POST"==f){var h,j=a.formData(),k=_createForOfIteratorHelper(j.entries());try{for(k.s();!(h=k.n()).done;)h.value}catch(a){k.e(a)}finally{k.f()}var n=b.onRequest(j);n&&n.then(function(){_Repository.Repository.request(e,{api:"json"},j,!1,{progressDown:function progressDown(a){b.progressDown(a)},progressUp:function progressUp(a){b.progressUp(a)}}).then(function(a){b.onResponse(a)})["catch"](function(a){b.onRequestError(a)})})}}})}},{key:"onRequest",value:function onRequest(a){var b=[];for(var c in this._onRequest){var d=this._onRequest[c](a,this);d&&b.push(d)}return 0==b.length?Promise.resolve():Promise.all(b)}},{key:"onRequestError",value:function onRequestError(a){for(var b in this._onError)this._onError[b](a,this);if(a.messages)for(var c in a.messages)_Toast.Toast.instance().alert(a.body&&a.body.id?"Success!":"Error!",a.messages[c],3500)}},{key:"onResponse",value:function onResponse(a){for(var b in this._onResponse)this._onResponse[b](a,this);if(a.messages)for(var c in a.messages)_Toast.Toast.instance().alert(a.body&&a.body.id?"Success!":"Error!",a.messages[c],3500)}},{key:"onLoad",value:function onLoad(a,b){for(var c in this._onLoad)this._onLoad[c](this,a,b)}},{key:"onSubmit",value:function onSubmit(a,b){for(var c in this._onSubmit)this._onSubmit[c](this,b)}},{key:"postRender",value:function postRender(){for(var a in this._onRender)this._onRender[a](this.args.form)}},{key:"customFields",value:function customFields(){return{}}},{key:"submit",value:function submit(){}},{key:"progressUp",value:function progressUp(a){console.log(a.loaded,a.total,a.loaded/a.total)}},{key:"progressDown",value:function progressDown(a){console.log(a.loaded,a.total,a.loaded/a.total)}}]),b}(_View2.View);exports.FormWrapper=FormWrapper;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SearchForm=void 0;var _Config=require("../../base/Config"),_FormWrapper2=require("./FormWrapper"),_HiddenField=require("../../form/HiddenField"),_Repository=require("../../base/Repository");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var backend=_Config.Config.get("backend")||"//",SearchForm=function(a){function b(a,d){var e,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return _classCallCheck(this,b),e=c.call(this,a,d,"POST",{search:_HiddenField.HiddenField}),e.superTemplate=e.template,e.args.records=[],e.selected=null,e.template="\n\t\t\t".concat(e.superTemplate,"\n\t\t\t<div cv-each = \"records:record:r\" class = \"dropdown-results\">\n\t\t\t\t<div\n\t\t\t\t\tcv-on         = \"click:select(event)\"\n\t\t\t\t\tdata-index    = \"[[r]]\"\n\t\t\t\t\tdata-publicId = \"[[record.publicId]]\"\n\t\t\t\t\tclass         = \"[[record.classes]]\"\n\t\t\t\t>\n\t\t\t\t\t[[record.title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"),e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"onLoad",value:function onLoad(a){var c=this;for(var e in a.args.fields)if(a.args.fields[e].tags.input&&"hidden"!=a.args.fields[e].args.attrs.type){var d=a.args.fields[e].tags.input.element;d.focus();break}a.args.flatValue.bindTo("keyword",function(a){c.args.records=[],c.selected=null,a&&(console.log(c.path,a),_Repository.Repository.request(backend+c.path,{keyword:a}).then(function(b){console.log(b.body),b.body&&(c.args.records=b.body.map(function(b){return b.classes="",b.title==a&&(b.classes="selected",c.selected=b),b}))}))}),_get(_getPrototypeOf(b.prototype),"onLoad",this).call(this,a)}},{key:"onRequest",value:function onRequest(){return _get(_getPrototypeOf(b.prototype),"onRequest",this).call(this)}},{key:"onResponse",value:function onResponse(a){_get(_getPrototypeOf(b.prototype),"onResponse",this).call(this,a)}},{key:"select",value:function select(a){var b=this,c=a.target.getAttribute("data-index"),d=a.target.getAttribute("data-publicId"),e=this.args.records[c];return console.log(e),this.args.view.addRecord(e),void this.args.view.addButtonClicked()}},{key:"onSubmit",value:function onSubmit(a,b){return b.preventDefault(),b.stopPropagation(),this.selected&&(this.args.view.addRecord(this.selected),this.args.view.addButtonClicked()),!1}}]),b}(_FormWrapper2.FormWrapper);exports.SearchForm=SearchForm;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.View=void 0;var _Config=require("../../base/Config"),_Form=require("../../form/Form"),_FieldSet2=require("../../form/FieldSet"),_CreateForm=require("./CreateForm"),_SearchForm=require("./SearchForm"),_FormWrapper=require("./FormWrapper"),_Wrapper=require("./Wrapper");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var View=function(a){function b(a,d,e,f){var g;for(var h in _classCallCheck(this,b),g=c.call(this,a,d,e,f),g.args._fields=[],g.dragging=!1,g.dropping=!1,g.args.fields)g.args._fields[h]=g.wrapSubfield(g.args.fields[h]);return g.args.fields[-1].disable(),g.args.creating="",g.args.fieldType="",g.args.createForm=g.args.createForm||"",g.args.searchForm=g.args.searchForm||"",g.args.createFormReady=!1,g.setCreateForm({view:_assertThisInitialized(g)}),g.args.loader="...",g.args.addIcon="&#215;",g.args.addIcon="a",g.args.addIcon="+",g.args.draggable="true",g.template="\n\t\t\t<label\n\t\t\t\tfor        = \"".concat(g.args.name,"\"\n\t\t\t\tdata-type  = \"").concat(g.args.attrs.type,"\"\n\t\t\t\tdata-multi = \"").concat(g.args.attrs["data-multi"]?"true":"false","\"\n\t\t\t>\n\t\t\t\t<span cv-if = \"title\">\n\t\t\t\t\t<span cv-ref = \"title:curvature/base/Tag\">[[title]]</span>\n\t\t\t\t</span>\n\n\t\t\t\t<fieldset\n\t\t\t\t\tname  = \"").concat(g.args.name,"\"\n\t\t\t\t\tclass = \"multi-field [[creating]] [[fieldType]]\"\n\t\t\t\t>\n\n\t\t\t\t\t<div class = \"record-list\" cv-each = \"_fields:field:f\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass     = \"single-record\"\n\t\t\t\t\t\t\tdata-for  = \"[[f]]\"\n\t\t\t\t\t\t>[[field]]</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay create\">\n\t\t\t\t\t\t<div class = \"form constrict\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\t\tclass = \"bubble bottom left-margin close\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t&#215;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t[[createForm]]\n\t\t\t\t\t\t[[searchForm]]\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class = \"overlay loading\">\n\t\t\t\t\t\t[[loader]]\n\t\t\t\t\t</div>\n\t\t\t\t\t<div cv-if = \"createFormReady\" class=\"add-button-holder\">\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tcv-on = \"click:addButtonClicked(event)\"\n\t\t\t\t\t\t\tclass = \"bubble bottom left-margin add\"\n\t\t\t\t\t\t\ttab-index = \"0\"\n\t\t\t\t\t\t>[[addIcon]]</div>\n\n\t\t\t\t\t</div>\n\n\t\t\t\t</fieldset>\n\n\t\t\t\t<span cv-each = \"errors:error:e\">\n\t\t\t\t\t<p class = \"cv-error\">[[error]]</p>\n\t\t\t\t</span>\n\n\t\t\t</label>\n\t\t"),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"setCreateForm",value:function setCreateForm(a){var b=this,c="";_Config.Config.get("backend")&&(c=_Config.Config.get("backend")),!1===this.args.attrs["data-create-endpoint"]?this.args.createFormReady=!0:(this.args.createForm=new _CreateForm.CreateForm(Object.assign({},a),this.args.attrs["data-create-endpoint"]?c+this.args.attrs["data-create-endpoint"]:a.publicId?c+"".concat(this.args.attrs["data-endpoint"],"/").concat(a.publicId,"/edit"):c+"".concat(this.args.attrs["data-endpoint"],"/create")),this.args.createForm._onLoad.push(function(){b.args.createFormReady=!0})),console.log(this.args.createFormReady),this.args.searchForm=new _SearchForm.SearchForm(Object.assign({},a),c+this.args.attrs["data-endpoint"])}},{key:"wrapSubfield",value:function wrapSubfield(a){return new _Wrapper.Wrapper({field:a,parent:this})}},{key:"addButtonClicked",value:function addButtonClicked(){this.args.creating||(this.args.creating="creating")}},{key:"addRecord",value:function addRecord(a){for(var f in this.args.creating="",Array.isArray(a)||(a=[a]),a){var b,c=this.args.fields[-1].constructor,d=Object.assign({},this.args.fields[-1].skeleton),e=Object.values(this.args.fields).length-1;d=this.cloneSkeleton(d),d=this.correctNames(d,e),d.attrs=null!==(b=d.attrs)&&void 0!==b?b:{},d.attrs["data-array"]=!0;var g={};g[e]=d;var h=_Form.Form.renderFields(g,this)[e];this.args.fields[e]=h;var i=this.wrapSubfield(h);h.args.value.id=a[f].id||"",h.args.value["class"]=a[f]["class"]||"",h.args.value.title=a[f].title||"",h.args.value.key=this.args._fields.length,this.args._fields.push(i),i.refresh(a[f])}}},{key:"editRecord",value:function editRecord(a,b){this.setCreateForm({view:this,publicId:a.publicId,wrapper:b}),this.args.creating=this.args.creating?"":"creating"}},{key:"deleteImage",value:function deleteImage(a){console.log(a,this.args.fields),this.args.fields[a].disable(),this.args._fields[a].args.classes="deleted"}},{key:"undeleteImage",value:function undeleteImage(a){this.args.fields[a].enable(),this.args._fields[a].args.classes=""}},{key:"cloneSkeleton",value:function cloneSkeleton(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c={};for(var d in Array.isArray(a)&&(c=[]),a)if("fields"!=d){if(!a[d]||"object"!==_typeof(a[d])){c[d]=a[d];continue}c[d]=Object.assign({},this.cloneSkeleton(a[d],b+1))}return c}},{key:"correctNames",value:function correctNames(a,b){if(a.name=a.name.replace(/\[-1\]/,"[".concat(b,"]")),a.attrs.name=a.name,"children"in a)for(var c in a.children)a.children[c]=this.correctNames(a.children[c],b);return a}},{key:"drag",value:function drag(a){this.dragging=a.target}},{key:"dragOver",value:function dragOver(a){if(!this.dragging)return!1;for(var b=a.target;b&&!b.matches("[draggable=\"true\"]");)b=b.parentNode;dropping&&(this.dropping=dropping,a.preventDefault())}},{key:"drop",value:function drop(a){a.stopPropagation();var b=this.dragging.querySelector("label"),c=this.dropping.querySelector("label"),d=b.getAttribute("for"),e=c.getAttribute("for"),f=this.extractIndex(d),g=this.extractIndex(e);if(f==g||f==g-1)return this.dragging=!1,void(this.dropping=!1);var h,j,k=b.querySelectorAll("[name^=\""+d+"\"]"),l=b.querySelectorAll("[for^=\""+d+"\"]"),m=c.querySelectorAll("[name^=\""+e+"\"]"),n=c.querySelectorAll("[for^=\""+e+"\"]"),o=this.dropping,p=0;for(var z in this.args.fields){var q=this.args.fields[z].tags.input.element,r=this.args.fields[z].tags.label.element,s=q.getAttribute("name");b==r&&(h=this.args.fields[z]),c==r&&(j=this.args.fields[z]);var t=this.extractIndex(s),u=!1;if(!(0>t)&&(f>g&&t>=g&&t<=f?(u=this.changeIndex(s,t+1),p=-1):f<g&&t<=g&&t>=f&&(u=this.changeIndex(s,t-1),p=0),!1!==u)){this.changeAttributePrefix(r,"for",s,u),this.args.fields[z].args.fieldName=u,this.changeAttributePrefix(q,"name",s,u);for(var v=q.parentNode.querySelectorAll("[name^=\""+s+"\"]"),w=0;w<v.length;w++)this.changeAttributePrefix(v[w],"name",s,u);for(var x=q.parentNode.querySelectorAll("[for^=\""+s+"\"]"),y=0;y<x.length;y++)this.changeAttributePrefix(x[y],"for",s,u)}}d=b.getAttribute("for"),e=c.getAttribute("for"),f=this.extractIndex(d),g=this.extractIndex(e),this.changeAttributePrefix(b,"for",d,this.changeIndex(d,g+p));for(var i=0;i<k.length;i++)this.changeAttributePrefix(k[i],"name",d,this.changeIndex(d,g+p));for(var A=0;A<l.length;A++)this.changeAttributePrefix(l[A],"for",d,this.changeIndex(d,g+p));h.args.fieldName=b.getAttribute("for"),this.changeAttributePrefix(c,"for",e,this.changeIndex(e,g+p+1));for(var B=0;B<m.length;B++)this.changeAttributePrefix(m[B],"name",e,this.changeIndex(e,g+p+1));for(var C=0;C<n.length;C++)this.changeAttributePrefix(n[C],"for",e,this.changeIndex(e,g+p+1));j.args.fieldName=c.getAttribute("for"),this.dragging.parentNode.insertBefore(this.dragging,o),this.dragging=!1,this.dropping=!1}},{key:"dragStop",value:function dragStop(){this.dragging=!1,this.dropping=!1}},{key:"changeAttributePrefix",value:function changeAttributePrefix(a,b,c,d){var e=a.getAttribute(b),f=d+a.getAttribute(b).substring(c.length);a.setAttribute(b,f)}},{key:"extractIndex",value:function extractIndex(a){var b;return!!(b=/\[(-?\d+)\]$/.exec(a))&&parseInt(b[1])}},{key:"changeIndex",value:function changeIndex(a,b){var c=a.replace(/\[(-?\d+)\]$/,"["+b+"]");return c}},{key:"cancel",value:function cancel(a){a.stopPropagation()}}]),b}(_FieldSet2.FieldSet);exports.View=View;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Wrapper=void 0;var _Config=require("../../base/Config"),_View2=require("../../base/View"),_Repository=require("../../base/Repository");function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Wrapper=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),d.template="\n\t\t\t<div\n\t\t\t\tclass = \"wrapped-field [[classes]]\"\n\t\t\t\tcv-on = \"click:editRecord(event, key)\"\n\t\t\t\ttitle = \"[[fieldName]]: [[id]]\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tcv-on = \"click:deleteImage(event, key)\"\n\t\t\t\t\tstyle = \"display: inline; cursor:pointer;\"\n\t\t\t\t>\n\t\t\t\t\t[[icon]]\n\t\t\t\t</div>\n\t\t\t\t<div class = \"field-content\">\n\t\t\t\t\t[[title]]\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div style = \"display:none\">[[field]]</div>\n\t\t",d.args.field=d.args.field||"!",d.args.keyword="",d.args.title="",d.args.record={},d.args.key=d.args.field.key,d.args.classes="",d.args.icon="\xD7",d.deleted=!1,d.args.field.args.bindTo("fieldName",function(a){d.args.fieldName=a}),d.args.fieldName=d.args.field.args.name,d.args.id=d.args.field.args.value.id,d.args.bindTo("id",function(a){d.args.field.args.value.id=a}),d.args.field.args.value.bindTo("id",function(a){a&&_Repository.Repository.request(d.backendPath(),{id:a}).then(function(b){d.args.id=a;var c=b.body[0];return c?void d.refresh(c):(d.args.publicId=null,void(d.args.title=null))})},{wait:0}),d.args.field.args.value.bindTo("keyword",function(a){d.args.keyword=a}),d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"editRecord",value:function editRecord(){this.args.parent.editRecord(this.args.record,this)}},{key:"deleteImage",value:function deleteImage(a,b){a.stopPropagation(),this.deleted?(this.args.icon="\xD7",this.args.parent.undeleteImage(b),this.deleted=!1):(this.args.icon="\u21BA",this.args.parent.deleteImage(b),this.deleted=!0)}},{key:"backendPath",value:function backendPath(){var a=_Config.Config.get("backend")||"//";return a+this.args.parent.args.attrs["data-endpoint"]}},{key:"getRecordTitle",value:function getRecordTitle(a){return a._titleField?a[a._titleField]:a.title||a.publicId||a.id}},{key:"refresh",value:function refresh(a){for(var b in a)this.args[b]=a[b];this.args.record=a,this.args.title=this.getRecordTitle(a)}}]),b}(_View2.View);exports.Wrapper=Wrapper;
